# GGJ2026 玩法设计文档（当前版本）

> 根据工程代码整理，供策划/美术/程序对齐当前实现。

---

## 1. 游戏概述

- **类型**：2D 多人在场、面具收集与对抗。
- **目标**：通过吃金币、吃玩家获得分数；通过切换/发射面具改变形态与战术。
- **人数**：支持多玩家（场景中通过 PlayerStart 配置出生点，输入支持 Player1～4）。

---

## 2. 核心循环

1. **移动**：四方向（上下左右）移动，速度由当前佩戴面具决定。
2. **吃金币**：触碰到可吃的金币获得分数（得分 × 当前面具得分倍率）。
3. **吃玩家**：碰撞到“可吃”的玩家时触发吃人逻辑（偷分、眩晕、被吃者改朝向逃离）。
4. **面具**：拾取地面/飞来的面具、切换背包内面具、发射当前面具攻击他人。
5. **波次事件**：每波持续一定时间，波次内会投放金币；波次结束后自动进入下一波。

---

## 3. 面具系统

### 3.1 面具类型（MaskType）

| 类型   | 说明     |
|--------|----------|
| None   | 无面具   |
| Tiger  | 老虎     |
| Sheep  | 羊       |
| Bird   | 鸟（可飞）|

每种面具在 **GameCfg → MaskDefine** 中单独配置。

### 3.2 面具配置项（MaskCfg，可策划配置）

| 配置项           | 说明 |
|------------------|------|
| 测试颜色         | 用于区分面具的显示颜色 |
| 面具图片         | 场景/玩家佩戴时显示的 Sprite，不填则用预制体原图 |
| 面具图标         | UI 背包槽用图，不填则用面具图片 |
| 基础速度         | 普通移动速度 |
| 追逐速度         | 当“前方有可吃的玩家”时使用的速度 |
| 得分倍率         | 吃金币时最终得分 = 金币分 × 倍率 |
| 能飞             | 勾选后玩家在 Bird 层，可穿过部分地形（鸟形态） |
| 能吃             | 列表：当前面具可以“吃”哪些其他面具（碰撞即触发吃人） |
| 只能吃大金币     | 勾选则只吃大金币，不勾则只吃小金币 |
| 掉落金币间隔(秒) | 戴该面具时每隔多久掉一次金币，0 表示不掉 |
| 每次掉落金币数   | 每次掉落扣除的分数，并在地面生成等分可拾取金币 |

### 3.3 背包与佩戴

- **背包**：列表 `maskBag`，容量由 `bagCapacity` 决定（默认 3，**含当前戴的**）。
- **槽位**：0 号位为“当前佩戴”，切换键按 0→1→2→… 循环换戴。
- **拾取新面具**：新面具插入 0 号位并立即佩戴，其余后移；若超出容量，最旧的面具会掉落在附近空地（远离玩家，且会避开墙）。
- **无面具**：背包可为 `None`，表示当前槽位无面具，仍占一个槽。

### 3.4 特殊规则（鸟面具）

- **飞行**：鸟面具配置为“能飞”时，玩家在 Bird 层，与地面层碰撞关系不同。
- **掉金币**：若配置了“掉落金币间隔”和“每次掉落金币数”，则每隔一段时间在脚下附近空地生成一枚可拾取金币，并扣除对应分数。
- **切换限制**：鸟形态时，若与墙重叠，**不允许切换面具**，避免切回地面层从墙里卡出。

---

## 4. 玩家操作

### 4.1 输入（InputManager）

- **移动**：上下左右（键盘/对应手柄方向）。
- **攻击键**：发射当前佩戴的面具（FireMask）。
- **切换键**：在背包内切换佩戴面具（0→1→2→…）。

支持多玩家：Player1～4 各自绑定键盘 + 可选手柄（Player1 手柄1，Player2 手柄2，以此类推）。

### 4.2 移动与速度

- **基础速度**：当前面具的 Speed。
- **追逐速度**：当前面具的 EatSpeed；当**当前朝向**上存在“可吃的玩家”时，使用 EatSpeed 代替 Speed。
- **眩晕**：被吃后进入短暂眩晕，期间速度为 0。

---

## 5. 发射面具（FireMask）

- **条件**：当前佩戴面具不为 None；且不在发射冷却内。
- **效果**：在玩家前方一定偏移位置生成飞行面具，沿当前朝向飞出；当前佩戴面具从背包移除（RemoveCurMask）。
- **飞行面具**：
  - 小碰撞体：用于撞墙停止、落地后被拾取。
  - 大碰撞体：用于飞行途中命中其他玩家（命中后对方获得该面具，飞行面具消失）。
- **撞墙**：仅小碰撞体触墙时停；停后面具会被移到附近空地，避免卡墙。
- **拾取限制**：
  - 发射者在配置的“发射者拾取冷却”时间内，不能拾取自己发射的该枚面具；其他玩家无此限制。
  - 地面上的面具（含撞墙后的）谁先碰到谁拾取（需满足当前面具形态的拾取判定）。

### 5.1 可配置参数（GameCfg）

- 发射面具速度（BulletSpeed）。
- 发射面具冷却（FireMaskCooldown）：同一玩家两次发射的最小间隔。
- 发射者拾取冷却（FiredByPickupBlockDuration）：发射者不能拾取自己刚发射的那枚面具的时长。

---

## 6. 吃玩家（DoEat）

- **触发**：两玩家发生**碰撞**（非仅触发），且吃人者当前面具的 CanEat 列表包含被吃者的当前面具。
- **效果**：
  - **吃人者**：获得被吃者部分分数（偷分比例可配）、进入短暂眩晕（吃人者眩晕时间可配）。
  - **被吃者**：扣除被偷的分数；**朝向**改为“逃离吃人者”的方向（会选短距离内无墙的方向，避免往墙里跑）；不位移、不摘面具。
- **配置**：偷分比例、吃人者眩晕时间、被吃者弹开距离（当前实现中弹开已改为“只改朝向不位移”）。

---

## 7. 金币与得分

### 7.1 金币类型（CoinType）

- **Small**：小金币。
- **Big**：大金币。

### 7.2 吃金币规则

- 玩家触碰到金币时，若**当前面具**允许吃该类型（OnlyEatBigCoin 控制只吃大/只吃小），则获得该金币的 `score` 分，并应用当前面具的**得分倍率**（最终得分 = 金币分 × 倍率）。
- 金币被吃后销毁。

### 7.3 波次与金币投放（GameEventManager）

- 游戏开始后按**波次**运行，每波持续时间为配置的 WaveDuration。
- 每波开始时会触发**金币投放事件**：第一波投放数量 = FirstWaveCoins，后续波 = CoinsPerWave。
- 投放位置与生成逻辑由 CoinSpawner + 事件配置（生成模式、检测半径等）决定。
- 波次结束后自动进入下一波（当前无波次结算逻辑）。

### 7.4 鸟面具掉金币

- 若面具配置了 DropCoinInterval 与 DropCoinAmount，则佩戴期间每隔一段时间在玩家附近空地生成一枚可拾取金币（Small），并扣除对应分数；不足则扣到 0 为止。

---

## 8. 地图与碰撞

- **墙**：Tag 为 `Wall`。面具撞墙仅认小碰撞体，停后移到附近空地（FindNearbyEmptyPosition：无碰撞且周围无墙）。
- **空地**：掉落面具、撞墙落点、鸟掉金币等，都会尽量选“无碰撞体且一定半径内无墙”的位置，避免与墙重叠。

---

## 9. UI 与表现

- **PlayerUI**：每个玩家有独立 UI，包含背包面具槽列表（按槽位显示，当前佩戴高亮）、分数。
- UI 可跟随玩家头顶（世界坐标转屏幕）；面具槽可使用 MaskIcon 或 MaskSprite 显示。
- 当前面具的 TestColor / MaskSprite 会同步到玩家身上的显示。

---

## 10. 配置汇总（GameCfg）

### 10.1 基础配置

- 玩家 Prefab、面具 Prefab、金币 Prefab。
- 发射面具速度、发射面具冷却、发射者拾取冷却。

### 10.2 吃掉玩家

- 偷分比例、吃人者眩晕时间、被吃者弹开距离（当前仅影响朝向逻辑）。

### 10.3 面具配置（MaskDefine）

- 每个 MaskType 一条 MaskCfg：速度、倍率、能吃列表、只吃大金币、能飞、掉落金币间隔/数量、图片/图标等。

### 10.4 事件配置（EventConfig）

- 每波持续时间、第一波/每波金币数量、生成模式、检测半径等。

---

## 11. 版本与备注

- 文档根据当前工程代码整理，若逻辑或配置有迭代，请以代码与 GameCfg 资源为准。
- 关键脚本：`PlayerController`、`MaskObject`、`GameCfg`、`GameEventManager`、`InputManager`、`Coin`、`PlayerUI`。
